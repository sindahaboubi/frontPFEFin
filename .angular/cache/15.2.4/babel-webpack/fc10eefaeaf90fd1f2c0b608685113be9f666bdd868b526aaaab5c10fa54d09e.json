{"ast":null,"code":"import { __values } from \"tslib\";\nimport { Router } from \"@angular/router\";\nimport * as JSZip from \"jszip\";\nimport { ToastrService } from \"ngx-toastr\";\nimport { AntiVerusService } from \"src/app/service/anti-verus.service\";\nimport { DossierService } from \"src/app/service/dossier.service\";\nimport { MembreService } from \"src/app/service/membre.service\";\nimport { WebSocketDossierService } from \"src/app/service/web-socket-dossier.service\";\nimport Swal from \"sweetalert2\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"ngx-toastr\";\nimport * as i2 from \"src/app/service/dossier.service\";\nimport * as i3 from \"src/app/service/anti-verus.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"src/app/service/web-socket-dossier.service\";\nimport * as i6 from \"src/app/service/membre.service\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"@angular/forms\";\nimport * as i9 from \"@angular/material/icon\";\nimport * as i10 from \"@angular/material/button\";\nimport * as i11 from \"@angular/material/list\";\nimport * as i12 from \"@angular/material/tooltip\";\nfunction TablesComponent_ng_container_23_mat_list_item_1_ng_container_6_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"button\", 22);\n    i0.ɵɵlistener(\"click\", function TablesComponent_ng_container_23_mat_list_item_1_ng_container_6_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r8);\n      var folder_r3 = i0.ɵɵnextContext().$implicit;\n      var ctx_r6 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r6.supprimerDossier(folder_r3));\n    });\n    i0.ɵɵelementStart(2, \"mat-icon\", 23);\n    i0.ɵɵtext(3, \"cancel\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n}\nfunction TablesComponent_ng_container_23_mat_list_item_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-list-item\", 17)(1, \"mat-icon\", 18)(2, \"a\", 19);\n    i0.ɵɵtext(3, \" folder \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"div\", 20);\n    i0.ɵɵtext(5);\n    i0.ɵɵtemplate(6, TablesComponent_ng_container_23_mat_list_item_1_ng_container_6_Template, 4, 0, \"ng-container\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 21);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    var folder_r3 = ctx.$implicit;\n    var ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"href\", \"data:application/octet-stream;base64,\", folder_r3.donnees, \"\", i0.ɵɵsanitizeUrl)(\"download\", \"\", folder_r3.nomDossier, \".zip\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", folder_r3.nomDossier, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", folder_r3.membreId == (ctx_r2.membre == null ? null : ctx_r2.membre.id));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"matTooltip\", \"emetteur : \" + folder_r3.membre.email);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"*\", folder_r3.membre.nom, \"*\");\n  }\n}\nfunction TablesComponent_ng_container_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, TablesComponent_ng_container_23_mat_list_item_1_Template, 9, 6, \"mat-list-item\", 16);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    var ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.projetDos);\n  }\n}\nfunction TablesComponent_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"h2\");\n    i0.ɵɵtext(2, \"Aucun Dossier Partag\\u00E9\");\n    i0.ɵɵelementEnd()();\n  }\n}\nvar TablesComponent = /** @class */function () {\n  function TablesComponent(toastr, dossierService, antiVerusService, router, webSocketService, membreService) {\n    var _this = this;\n    this.toastr = toastr;\n    this.dossierService = dossierService;\n    this.antiVerusService = antiVerusService;\n    this.router = router;\n    this.webSocketService = webSocketService;\n    this.membreService = membreService;\n    this.zip = new JSZip();\n    this.formData = new FormData();\n    this.verus = true;\n    this.projetDos = [];\n    this.webSocketService.messageHandlingAddDos(null).subscribe(function (message) {\n      if (message.subscribe && message.subscribe.projetId == JSON.parse(localStorage.getItem('projet')).id) _this.projetDos.push(message.subscribe);\n    });\n    this.webSocketService.messageHandlingSupprimerDos(null).subscribe(function (message) {\n      console.log(message);\n      if (message.supprimer && _this.projetDos.find(function (dos) {\n        return dos.id == message.supprimer.id;\n      }) && message.supprimer.projetId == JSON.parse(localStorage.getItem('projet')).id) _this.projetDos.splice(_this.projetDos.indexOf(_this.projetDos.find(function (dos) {\n        return dos.id == message.supprimer.id;\n      })), 1);\n    });\n  }\n  TablesComponent.prototype.ngOnInit = function () {\n    var _this = this;\n    this.membre = this.membreService.getMembreFromToken();\n    this.folderName = \"\";\n    var projet = JSON.parse(localStorage.getItem('projet'));\n    this.dossierService.recupererDossierDeProjet(projet.id).subscribe(function (data) {\n      if (data) _this.projetDos = data;\n      console.log(data);\n    }, function (error) {});\n  };\n  TablesComponent.prototype.onFileChange = function (event) {\n    var e_1, _a;\n    var _this = this;\n    var files = event.target.files;\n    this.folderName = files[0].webkitRelativePath.split('/')[0];\n    var totalSize = 0;\n    for (var i = 0; i < files.length; i++) {\n      totalSize += files[i].size;\n    }\n    if (totalSize > 30000000) {\n      console.log(\"error\");\n      this.toastr.error(\"ce fichier contient plus que 300MB\");\n      event.target.value = '';\n    } else {\n      var folderNameDiv = document.getElementById(\"folderName\");\n      var folderDiv = document.getElementById(\"folder\");\n      folderDiv.classList.add(\"has-files\");\n      folderNameDiv.innerHTML = \"nom de dossier : \" + this.folderName;\n      try {\n        for (var files_1 = __values(files), files_1_1 = files_1.next(); !files_1_1.done; files_1_1 = files_1.next()) {\n          var file = files_1_1.value;\n          var path = file.webkitRelativePath.split(\"\".concat(this.folderName, \"/\"))[1];\n          this.zip.file(path, file);\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (files_1_1 && !files_1_1.done && (_a = files_1.return)) _a.call(files_1);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n      this.antiVerusService.checkVerus(this.zip).then(function (response) {\n        _this.antiVerusService.getReport().subscribe(function (resultat) {\n          if (resultat.data.attributes.stats.malicious > 0) {\n            _this.toastr.error(\"Virus détecté !! \\nAttention a ce que vous emettez dans l'application\");\n            _this.reloadPage();\n          } else {\n            _this.toastr.success(\"Dossier sain.\");\n            _this.verus = false;\n          }\n        });\n      });\n    }\n  };\n  TablesComponent.prototype.reloadPage = function () {\n    var _this = this;\n    this.router.navigateByUrl('/', {\n      skipLocationChange: true\n    }).then(function () {\n      _this.router.navigate([_this.router.url]);\n    });\n  };\n  TablesComponent.prototype.uploadDos = function () {\n    var _this = this;\n    this.zip.generateAsync({\n      type: 'blob'\n    }).then(function (content) {\n      var formData = new FormData();\n      formData.append(\"compressedFile\", content, \"\".concat(_this.folderName, \".zip\"));\n      /** appel au service Dossier */\n      var dossier = {\n        projetId: JSON.parse(localStorage.getItem('projet')).id,\n        membreId: _this.membreService.getMembreFromToken().id,\n        donnees: formData,\n        nomDossier: _this.folderName\n      };\n      _this.dossierService.sauvegarderDossier(dossier).subscribe(function (data) {\n        if (data) _this.webSocketService.messageHandlingAddDos(data).subscribe(function (message) {\n          // afficher le message reçu dans la console\n          console.log(message);\n        }, function (err) {\n          console.error(err); // afficher les erreurs dans la console\n        }, function () {\n          console.log('WebSocket connection closed'); // afficher un message lorsque la connexion est fermée\n        });\n      }, function (error) {\n        _this.toastr.error(\"vous avez déjà inserer ce dossier\");\n      });\n      /** end */\n    });\n  };\n\n  TablesComponent.prototype.supprimerDossier = function (dossier) {\n    var _this = this;\n    Swal.fire({\n      title: \"Clé correct, vous êtes sûr de supprimer le dossier : \" + dossier.nomDossier,\n      icon: 'info',\n      showCancelButton: true,\n      confirmButtonColor: '#3085d6',\n      cancelButtonColor: '#d33',\n      confirmButtonText: 'Oui, Lancer!',\n      cancelButtonText: 'Annuler',\n      background: 'rgba(0,0,0,0.9)',\n      backdrop: 'rgba(0,0,0,0.4)',\n      allowOutsideClick: false,\n      allowEscapeKey: false,\n      allowEnterKey: false,\n      focusConfirm: false\n    }).then(function (result) {\n      if (result.isConfirmed) {\n        _this.dossierService.supprimerDos(dossier.id).subscribe(function (data) {\n          //this.projetDos.splice(this.projetDos.indexOf(this.projetDos.find(dos => dos.id == dossier.id)),1)\n          _this.webSocketService.messageHandlingSupprimerDos(dossier).subscribe(function (message) {\n            console.log(message);\n          });\n        }, function (error) {\n          Swal.fire('Erreur', 'suppression impossible ', 'error');\n        });\n      }\n    });\n  };\n  TablesComponent.ɵfac = function TablesComponent_Factory(t) {\n    return new (t || TablesComponent)(i0.ɵɵdirectiveInject(i1.ToastrService), i0.ɵɵdirectiveInject(i2.DossierService), i0.ɵɵdirectiveInject(i3.AntiVerusService), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i5.WebSocketDossierService), i0.ɵɵdirectiveInject(i6.MembreService));\n  };\n  TablesComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: TablesComponent,\n    selectors: [[\"app-tables\"]],\n    decls: 25,\n    vars: 3,\n    consts: [[1, \"content\"], [1, \"row\"], [1, \"col-md-12\"], [1, \"card\"], [1, \"card-body\"], [\"id\", \"folder\", 1, \"file-upload\", 2, \"cursor\", \"pointer\"], [\"for\", \"folder-upload\"], [\"matTooltip\", \"click pour choisir un dossier\", 1, \"file-icon\", \"fas\", \"fa-folder\"], [\"type\", \"file\", \"formControlName\", \"formData\", \"id\", \"folder-upload\", \"webkitdirectory\", \"\", 2, \"width\", \"100%\", \"height\", \"100%\", 3, \"change\"], [\"type\", \"button\", 1, \"file-upload-btn\", 3, \"disabled\", \"click\"], [\"id\", \"folderName\", 1, \"file-name\"], [1, \"card-header\"], [1, \"card-title\"], [1, \"category\"], [1, \"col-lg-12\", \"col-sm-12\", \"col-md-12\", \"col-xs-12\", 2, \"margin-left\", \"3%\", \"display\", \"flex\", \"flex-wrap\", \"wrap\"], [4, \"ngIf\"], [\"style\", \"flex-basis: 25%;\", 4, \"ngFor\", \"ngForOf\"], [2, \"flex-basis\", \"25%\"], [\"matListItemIcon\", \"\", 1, \"text-light\", 2, \"cursor\", \"pointer\"], [3, \"href\", \"download\"], [\"matListItemTitle\", \"\", 1, \"folder-text\"], [\"matListItemLine\", \"\", 1, \"text-light\", 2, \"font-size\", \"10px\", 3, \"matTooltip\"], [\"mat-mini-fab\", \"\", \"matTooltip\", \"supprimer dossier\", 1, \"p-2\", \"bd-highlight\", \"text-danger\", \"btn\", 3, \"click\"], [1, \"w-100\", \"h-100\"]],\n    template: function TablesComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"div\", 4)(5, \"div\", 5);\n        i0.ɵɵelement(6, \"br\");\n        i0.ɵɵelementStart(7, \"label\", 6);\n        i0.ɵɵelement(8, \"i\", 7);\n        i0.ɵɵtext(9, \" S\\u00E9lectionnez un dossier \\u00E0 uploader\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"input\", 8);\n        i0.ɵɵlistener(\"change\", function TablesComponent_Template_input_change_10_listener($event) {\n          return ctx.onFileChange($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"button\", 9);\n        i0.ɵɵlistener(\"click\", function TablesComponent_Template_button_click_11_listener() {\n          return ctx.uploadDos();\n        });\n        i0.ɵɵtext(12, \"Uploader\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(13, \"div\", 10);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(14, \"div\", 2)(15, \"div\", 3)(16, \"div\", 11)(17, \"h4\", 12);\n        i0.ɵɵtext(18, \"Projet Bureau\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(19, \"p\", 13);\n        i0.ɵɵtext(20, \"vous trouverez ici tous les dossiers partager entre les different membres\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(21, \"div\", 4)(22, \"mat-list\", 14);\n        i0.ɵɵtemplate(23, TablesComponent_ng_container_23_Template, 2, 1, \"ng-container\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(24, TablesComponent_div_24_Template, 3, 0, \"div\", 15);\n        i0.ɵɵelementEnd()()()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(11);\n        i0.ɵɵproperty(\"disabled\", ctx.folderName == \"\" || ctx.verus);\n        i0.ɵɵadvance(12);\n        i0.ɵɵproperty(\"ngIf\", ctx.projetDos.length > 0);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.projetDos.length == 0);\n      }\n    },\n    dependencies: [i7.NgForOf, i7.NgIf, i8.DefaultValueAccessor, i8.NgControlStatus, i8.FormControlName, i9.MatIcon, i10.MatMiniFabButton, i11.MatList, i11.MatListItem, i11.MatListItemIcon, i11.MatListItemLine, i11.MatListItemTitle, i12.MatTooltip],\n    styles: [\".file-upload[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n  margin: 20px;\\n  border: 1px rgba(255, 255, 255, 0.3) dashed;\\n}\\n\\ni[_ngcontent-%COMP%] {\\n  cursor: pointer;\\n}\\n\\n\\n.file-upload[_ngcontent-%COMP%]   label[_ngcontent-%COMP%] {\\n  font-size: 1.5rem;\\n  font-weight: bold;\\n  margin-bottom: 0.5rem;\\n  text-align: center;\\n}\\n\\n\\n.file-upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%] {\\n  display: none;\\n  cursor: pointer;\\n}\\n\\n.file-upload[_ngcontent-%COMP%]   .file-upload-btn[_ngcontent-%COMP%] {\\n  background-color: #f44336;\\n  border: none;\\n  color: #fff;\\n  cursor: pointer;\\n  font-size: 1rem;\\n  font-weight: bold;\\n  margin-top: 1rem;\\n  padding: 1rem 2rem;\\n  text-transform: uppercase;\\n}\\n\\n.file-upload[_ngcontent-%COMP%]   .file-upload-btn[_ngcontent-%COMP%]:hover {\\n  background-color: #d32f2f;\\n}\\n\\n.file-upload[_ngcontent-%COMP%]   .file-upload-btn[_ngcontent-%COMP%]:focus {\\n  outline: none;\\n}\\n\\n.file-upload[_ngcontent-%COMP%]   .file-upload-btn[_ngcontent-%COMP%]:active {\\n  box-shadow: inset 0 2px 2px rgba(0, 0, 0, 0.3);\\n}\\n\\n\\n.file-upload[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%] {\\n  font-size: 1rem;\\n  margin-top: 1rem;\\n  text-align: center;\\n}\\n\\n\\n.file-upload[_ngcontent-%COMP%]   .file-icon[_ngcontent-%COMP%] {\\n  font-size: 4rem;\\n  margin-bottom: 1rem;\\n}\\n\\n\\n.file-upload.has-files[_ngcontent-%COMP%]   .file-upload-btn[_ngcontent-%COMP%] {\\n  background-color: #4caf50;\\n}\\n\\n.file-upload.has-files[_ngcontent-%COMP%]   .file-upload-btn[_ngcontent-%COMP%]:hover {\\n  background-color: #388e3c;\\n}\\n\\n.file-upload.has-files[_ngcontent-%COMP%]   .file-upload-btn[_ngcontent-%COMP%]:active {\\n  box-shadow: inset 0 2px 2px rgba(0, 0, 0, 0.3);\\n}\\n\\n.file-upload.has-files[_ngcontent-%COMP%]   .file-icon[_ngcontent-%COMP%] {\\n  color: #4caf50;\\n}\\n\\n.file-upload.has-files[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%] {\\n  color: #4caf50;\\n}\\n\\n.folder-text[_ngcontent-%COMP%] {\\n  color: rgba(255, 255, 255, 0.3);\\n}\\n\\na[_ngcontent-%COMP%] {\\n  color: wheat;\\n}\\n\\n.btn[_ngcontent-%COMP%] {\\n  border-radius: 50%;\\n  border: transparent;\\n  background-color: transparent;\\n}\"]\n  });\n  return TablesComponent;\n}();\nexport { TablesComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}